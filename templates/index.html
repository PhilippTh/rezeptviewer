<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezept Viewer</title>
    <script src="/static/functions.js"></script>
    <link rel="stylesheet" href="/static/style.css">
    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <div class="header">
        <div class="header-text">
            <h1>🍽️ Rezept Viewer</h1>
            <div class="subtitle">Familienrezepte der Waldschenke</div>
        </div>
        <div class="auth-section">
            <div id="loginSection" class="login-form">
                <input type="text" id="username" placeholder="Benutzername" style="padding: 6px 8px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
                <input type="password" id="password" placeholder="Passwort" style="padding: 6px 8px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
                <button class="btn btn-primary btn-small" onclick="login()">🔓 Login</button>
            </div>
            <div id="userSection" class="user-info" style="display: none;">
                <span id="userDisplay"></span>
                <button class="btn btn-secondary btn-small" onclick="showPasswordChangeForm()">🔑 Passwort ändern</button>
                <button class="btn btn-secondary btn-small" onclick="logout()">🔒 Logout</button>
            </div>
        </div>
        <img src="/static/logo.png" alt="Waldschenke Logo" class="logo">
    </div>

    <div class="controls-bar">
        <div class="controls-section">
            <h3>🍳 Rezept-Verwaltung</h3>
            <div class="controls-row">
                <button class="btn btn-primary admin-buttons" onclick="toggleAddForm()">
                    ➕ Neues Rezept hinzufügen
                </button>
                <button class="btn btn-secondary" onclick="generateShoppingList()">
                    🛒 Einkaufsliste erstellen
                </button>
                <button class="btn btn-secondary" onclick="window.print()">
                    🖨️ Drucken
                </button>
            </div>
        </div>
        
        <div class="controls-section">
            <h3>🔍 Suchen & Filtern</h3>
            <div class="controls-row">
                <input type="text" id="searchInput" class="search-input" placeholder="🔍 Rezept suchen..." oninput="searchRecipes()">
                <select id="categoryFilter" class="filter-select" onchange="filterByCategory()">
                    <option value="">📂 Alle Kategorien</option>
                </select>
                <select id="sortBy" onchange="sortRecipes()">
                    <option value="title">📝 Nach Titel</option>
                    <option value="date">📅 Nach Datum</option>
                    <option value="category">📂 Nach Kategorie</option>
                </select>
            </div>
        </div>
        
        <div class="controls-section admin-buttons">
            <h3>⚙️ Admin-Verwaltung</h3>
            <div class="controls-row">
                <button class="btn btn-secondary" onclick="toggleCategoryManagement()">
                    🏷️ Kategorien bearbeiten
                </button>
                <button class="btn btn-secondary" onclick="toggleExportManagement()">
                    📤 Daten exportieren
                </button>
            </div>
        </div>
    </div>

    <div class="add-recipe-form" id="addRecipeForm">
        <h3 id="formTitle">➕ Neues Rezept hinzufügen</h3>
        <form onsubmit="submitRecipe(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label for="title">Titel:</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="category">Kategorie:</label>
                    <select id="category">
                        <option value="">-- Kategorie wählen --</option>
                    </select>
                    <input type="text" id="newCategory" placeholder="Neue Kategorie eingeben..." style="margin-top: 8px; display: none;">
                </div>
                <div class="form-group">
                    <label for="portions">Portionen:</label>
                    <input type="text" id="portions">
                </div>
                <div class="form-group">
                    <label for="image">Bild:</label>
                    <input type="file" id="image" accept="image/*">
                </div>
            </div>
            
            <div class="form-group">
                <label for="ingredients">Zutaten:</label>
                <textarea id="ingredients" required placeholder="Liste der Zutaten..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="instructions">Anweisungen:</label>
                <textarea id="instructions" placeholder="Schritt-für-Schritt Anweisungen..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="notes">Hinweise:</label>
                <textarea id="notes" placeholder="Zusätzliche Hinweise oder Tipps..."></textarea>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">💾 Rezept speichern</button>
                <button type="button" class="btn btn-secondary" onclick="toggleAddForm()">❌ Abbrechen</button>
            </div>
        </form>
    </div>

    <div class="add-recipe-form" id="categoryManagement" style="display: none;">
        <h3>🏷️ Kategorien verwalten</h3>
        <div id="categoryList"></div>
        <div style="margin-top: 20px;">
            <button class="btn btn-secondary" onclick="toggleCategoryManagement()">❌ Schließen</button>
        </div>
    </div>

    <div class="add-recipe-form" id="exportManagement" style="display: none;">
        <h3>📤 Daten exportieren</h3>
        <div style="display: grid; gap: 20px;">
            <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                <h4 style="margin: 0 0 12px 0; color: #2d3748; display: flex; align-items: center; gap: 8px;">
                    📄 JSON Export (Rezepte)
                </h4>
                <p style="margin: 0 0 16px 0; color: #4a5568; font-size: 14px;">
                    Exportiert alle Rezepte als JSON-Datei für Backup oder Migration.
                </p>
                <button class="btn btn-primary" onclick="exportRecipes()">
                    📄 JSON Export herunterladen
                </button>
            </div>
            
            <div style="padding: 20px; background: #f0f9ff; border-radius: 8px; border: 1px solid #0ea5e9;">
                <h4 style="margin: 0 0 12px 0; color: #0369a1; display: flex; align-items: center; gap: 8px;">
                    🗄️ SQL Database Export
                </h4>
                <p style="margin: 0 0 16px 0; color: #0369a1; font-size: 14px;">
                    Exportiert die komplette Datenbank als SQL-Dump für vollständige Backups.
                </p>
                <button class="btn btn-primary" onclick="exportDatabase()" style="background: #0ea5e9;">
                    🗄️ SQL Export herunterladen
                </button>
            </div>
            
            <div style="padding: 20px; background: #fef3c7; border-radius: 8px; border: 1px solid #f59e0b;">
                <h4 style="margin: 0 0 12px 0; color: #92400e; display: flex; align-items: center; gap: 8px;">
                    ⚠️ Import/Export Hinweise
                </h4>
                <ul style="margin: 0; padding-left: 20px; color: #92400e; font-size: 14px;">
                    <li>JSON-Export: Nur Rezeptdaten, ideal für Backup der Inhalte</li>
                    <li>SQL-Export: Komplette Datenbank inklusive Benutzer und Kategorien</li>
                    <li>Speichern Sie Exporte regelmäßig als Backup</li>
                    <li>SQL-Import erfordert Datenbankzugriff über Docker/Terminal</li>
                </ul>
            </div>
        </div>
        <div style="margin-top: 20px;">
            <button class="btn btn-secondary" onclick="toggleExportManagement()">❌ Schließen</button>
        </div>
    </div>

    <div class="add-recipe-form" id="passwordChangeForm" style="display: none;">
        <h3>🔑 Admin-Passwort ändern</h3>
        <div class="form-grid">
            <div class="form-group">
                <label for="currentPassword">Aktuelles Passwort:</label>
                <input type="password" id="currentPassword" required>
            </div>
            <div class="form-group">
                <label for="newPassword">Neues Passwort:</label>
                <input type="password" id="newPassword" required>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Passwort bestätigen:</label>
                <input type="password" id="confirmPassword" required>
            </div>
        </div>
        <div class="form-actions">
            <button class="btn btn-primary" onclick="changePassword()">🔒 Passwort ändern</button>
            <button class="btn btn-secondary" onclick="closePasswordChangeForm()">❌ Abbrechen</button>
        </div>
    </div>

    <div class="shopping-list" id="shoppingList" style="display: none;">
        <h3>🛒 Einkaufsliste</h3>
        <div id="shoppingItems"></div>
        <button class="btn btn-secondary btn-small" onclick="closeShoppingList()">Schließen</button>
    </div>

    <div id="recipeGrid" class="recipe-grid">
        <!-- Recipes will be loaded here -->
    </div>

    <!-- Single Recipe Overlay -->
    <div id="singleRecipeOverlay" class="single-recipe-overlay" onclick="closeSingleRecipe(event)">
        <div class="single-recipe-container" onclick="event.stopPropagation()">
            <div class="single-recipe-header">
                <div class="single-recipe-nav">
                    <button class="back-button" onclick="closeSingleRecipe()">
                        ← Zurück zur Übersicht
                    </button>
                    <div id="singleRecipeActions" class="recipe-actions">
                        <!-- Actions will be populated here -->
                    </div>
                </div>
                <h1 id="singleRecipeTitle" class="single-recipe-title"></h1>
                <div id="singleRecipeMeta" class="single-recipe-meta">
                    <!-- Meta info will be populated here -->
                </div>
            </div>
            <div class="single-recipe-content">
                <div id="singleRecipeContent">
                    <!-- Recipe content will be populated here -->
                </div>
            </div>
        </div>
    </div>
    </div> <!-- app-container -->
</body>
</html>