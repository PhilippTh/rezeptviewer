<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezept Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            max-height: 80px;
            max-width: 200px;
            width: auto;
            height: auto;
            object-fit: contain;
        }
        
        .header-text {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2em;
        }
        
        .header p {
            margin: 0;
            color: #666;
            font-style: italic;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .recipe-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .recipe-card:hover {
            transform: translateY(-2px);
        }
        
        .recipe-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .recipe-meta {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .recipe-content {
            line-height: 1.6;
        }
        
        .recipe-section {
            margin-bottom: 15px;
        }
        
        .recipe-section h4 {
            margin: 0 0 8px 0;
            color: #34495e;
            font-size: 1em;
        }
        
        .recipe-section p {
            margin: 0;
            color: #2c3e50;
        }
        
        select, button, input {
            padding: 8px 12px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background: #3498db;
            color: white;
            cursor: pointer;
            border: none;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .add-recipe-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        /* Print Styles */
        @media print {
            body {
                background-color: white !important;
                max-width: none;
                margin: 0;
                padding: 15px;
            }
            
            .controls, .add-recipe-form {
                display: none !important;
            }
            
            .header {
                margin-bottom: 20px;
                page-break-after: avoid;
            }
            
            .logo {
                max-height: 60px;
                max-width: 150px;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            .recipe-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .recipe-card {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
                margin-bottom: 15px;
            }
            
            .recipe-card:hover {
                transform: none;
            }
            
            .recipe-title {
                color: #000 !important;
                font-size: 1.1em;
            }
            
            .recipe-meta {
                color: #444 !important;
            }
            
            .recipe-section h4 {
                color: #000 !important;
            }
            
            .recipe-section p {
                color: #000 !important;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="/static/logo.png" alt="Waldschenke Logo" class="logo">
        <div class="header-text">
            <h1>üçΩÔ∏è Rezept Viewer</h1>
            <p>Rezepte von Papa</p>
        </div>
    </div>

    <div class="controls">
        <button onclick="toggleAddForm()">Neues Rezept hinzuf√ºgen</button>
        <select id="categoryFilter" onchange="filterByCategory()">
            <option value="">Alle Kategorien</option>
        </select>
        <input type="text" id="searchInput" placeholder="Rezept suchen..." oninput="searchRecipes()">
        <button onclick="loadRecipes()">Neu laden</button>
    </div>

    <div class="add-recipe-form" id="addRecipeForm">
        <h3>Neues Rezept hinzuf√ºgen</h3>
        <form onsubmit="addRecipe(event)">
            <div class="form-group">
                <label for="title">Titel:</label>
                <input type="text" id="title" required>
            </div>
            <div class="form-group">
                <label for="category">Kategorie:</label>
                <input type="text" id="category">
            </div>
            <div class="form-group">
                <label for="portions">Portionen:</label>
                <input type="text" id="portions">
            </div>
            <div class="form-group">
                <label for="ingredients">Zutaten:</label>
                <textarea id="ingredients" required></textarea>
            </div>
            <div class="form-group">
                <label for="instructions">Anweisungen:</label>
                <textarea id="instructions" required></textarea>
            </div>
            <div class="form-group">
                <label for="notes">Hinweise:</label>
                <textarea id="notes"></textarea>
            </div>
            <button type="submit">Rezept speichern</button>
            <button type="button" onclick="toggleAddForm()">Abbrechen</button>
        </form>
    </div>

    <div class="recipe-grid" id="recipeGrid">
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let allRecipes = [];

        async function loadRecipes() {
            try {
                const response = await fetch(`${API_BASE}/recipes`);
                allRecipes = await response.json();
                displayRecipes(allRecipes);
                loadCategories();
            } catch (error) {
                console.error('Error loading recipes:', error);
                document.getElementById('recipeGrid').innerHTML = '<p>Fehler beim Laden der Rezepte. Stelle sicher, dass der Server l√§uft.</p>';
            }
        }

        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`);
                const categories = await response.json();
                const select = document.getElementById('categoryFilter');
                select.innerHTML = '<option value="">Alle Kategorien</option>';
                categories.forEach(cat => {
                    if (cat) {
                        const option = document.createElement('option');
                        option.value = cat;
                        option.textContent = cat;
                        select.appendChild(option);
                    }
                });
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function displayRecipes(recipes) {
            const grid = document.getElementById('recipeGrid');
            grid.innerHTML = '';

            if (recipes.length === 0) {
                grid.innerHTML = '<p>Keine Rezepte gefunden.</p>';
                return;
            }

            recipes.forEach(recipe => {
                const card = document.createElement('div');
                card.className = 'recipe-card';
                
                card.innerHTML = `
                    <div class="recipe-title">${recipe.title || 'Ohne Titel'}</div>
                    <div class="recipe-meta">
                        ${recipe.category ? `Kategorie: ${recipe.category}` : ''}
                        ${recipe.portions ? ` | Portionen: ${recipe.portions}` : ''}
                        ${recipe.created_date ? ` | ${recipe.created_date}` : ''}
                    </div>
                    <div class="recipe-content">
                        ${recipe.ingredients ? `
                            <div class="recipe-section">
                                <h4>Zutaten:</h4>
                                <p>${recipe.ingredients}</p>
                            </div>
                        ` : ''}
                        ${recipe.instructions ? `
                            <div class="recipe-section">
                                <h4>Anweisungen:</h4>
                                <p>${recipe.instructions}</p>
                            </div>
                        ` : ''}
                        ${recipe.notes ? `
                            <div class="recipe-section">
                                <h4>Hinweise:</h4>
                                <p>${recipe.notes}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function filterByCategory() {
            const category = document.getElementById('categoryFilter').value;
            if (!category) {
                displayRecipes(allRecipes);
            } else {
                const filtered = allRecipes.filter(recipe => recipe.category === category);
                displayRecipes(filtered);
            }
        }

        function searchRecipes() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            if (!search) {
                displayRecipes(allRecipes);
                return;
            }

            const filtered = allRecipes.filter(recipe => 
                (recipe.title && recipe.title.toLowerCase().includes(search)) ||
                (recipe.ingredients && recipe.ingredients.toLowerCase().includes(search)) ||
                (recipe.instructions && recipe.instructions.toLowerCase().includes(search))
            );
            displayRecipes(filtered);
        }

        function toggleAddForm() {
            const form = document.getElementById('addRecipeForm');
            if (form.style.display === 'none' || !form.style.display) {
                form.style.display = 'block';
            } else {
                form.style.display = 'none';
            }
        }

        async function addRecipe(event) {
            event.preventDefault();
            
            const recipe = {
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                portions: document.getElementById('portions').value,
                ingredients: document.getElementById('ingredients').value,
                instructions: document.getElementById('instructions').value,
                notes: document.getElementById('notes').value
            };

            try {
                const response = await fetch(`${API_BASE}/recipes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(recipe)
                });

                if (response.ok) {
                    alert('Rezept erfolgreich hinzugef√ºgt!');
                    toggleAddForm();
                    event.target.reset();
                    loadRecipes();
                } else {
                    alert('Fehler beim Hinzuf√ºgen des Rezepts.');
                }
            } catch (error) {
                console.error('Error adding recipe:', error);
                alert('Fehler beim Hinzuf√ºgen des Rezepts.');
            }
        }

        // Load recipes on page load
        loadRecipes();
    </script>
</body>
</html>